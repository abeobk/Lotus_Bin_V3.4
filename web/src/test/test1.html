<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Collapsible & Resizable Sections</title>
    <style>
        html,
        body {
            margin: 0;
            height: 100%;
            font-family: sans-serif;
            font-size:12px;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .section {
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            min-height: 1rem;
            overflow: hidden;
        }

        .header {
            background: #f0f0f0;
            padding: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            flex-shrink: 0;
            max-height:0.5rem;
        }

        .header button {
            font-size: 14px;
            padding: 2px 8px;
        }

        .content {
            flex: 1;
            overflow: auto;
            padding: 10px;
        }

        .resizer {
            height: 5px;
            background: #ddd;
            cursor: row-resize;
            flex-shrink: 0;
        }

        .collapsed .content,
        .collapsed .resizer {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="section" data-id="section1" style="flex:1">
            <div class="header"><span>Section 1</span><button>+</button></div>
            <div class="content">Content of section 1</div>
            <div class="resizer"></div>
        </div>
        <div class="section" data-id="section2" style="flex:1">
            <div class="header"><span>Section 2</span><button>+</button></div>
            <div class="content">Content of section 2</div>
            <div class="resizer"></div>
        </div>
        <div class="section" data-id="section3" style="flex:1">
            <div class="header"><span>Section 2</span><button>+</button></div>
            <div class="content">Content of section 2</div>
            <div class="resizer"></div>
        </div>
        <div class="section" data-id="section3" style="flex:1">
            <div class="header"><span>Section 2</span><button>+</button></div>
            <div class="content">Content of section 2</div>
            <div class="resizer"></div>
        </div>
        <div class="section" data-id="section4" style="flex:1">
            <div class="header"><span>Section 3</span><button>+</button></div>
            <div class="content">Content of section 3</div>
        </div>
    </div>

    <script>
        (function () {
            const container = document.querySelector('.container');
            const sections = document.querySelectorAll('.section');
            const STORAGE_KEY = 'sectionStates';

            function loadStates() {
                const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                sections.forEach(sec => {
                    const id = sec.dataset.id;
                    const state = saved[id];
                    if (state) {
                        if (state.collapsed) sec.classList.add('collapsed');
                        if (state.flex) sec.style.flex = state.flex;
                    }
                    updateButton(sec);
                });
            }

            function saveStates() {
                const data = {};
                sections.forEach(sec => {
                    const id = sec.dataset.id;
                    data[id] = {
                        collapsed: sec.classList.contains('collapsed'),
                        flex: sec.style.flex
                    };
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            }

            function updateButton(section) {
                const btn = section.querySelector('button');
                btn.textContent = section.classList.contains('collapsed') ? '+' : 'âˆ’';
            }

            sections.forEach((sec, i) => {
                const header = sec.querySelector('.header');
                header.addEventListener('click', () => {
                    const collapsed = sec.classList.toggle('collapsed');
                    updateButton(sec);

                    if (collapsed) {
                        sec.style.flex = "0 0 auto"; // only header remains
                        // give its space to the previous expanded section
                        for (let j = i - 1; j >= 0; j--) {
                            const prev = sections[j];
                            if (!prev.classList.contains('collapsed')) {
                                const collapsedFlex = parseFloat(sec.style.flex || 1);
                                const prevFlex = parseFloat(prev.style.flex || 1);
                                prev.style.flex = prevFlex + collapsedFlex;
                                break;
                            }
                        }
                    } else {
                        sec.style.flex = 1; // restore expandability
                    }
                    saveStates();
                });
            });

            // --- Resizer logic ---
            let startY, startFlex, nextFlex, current, next;
            document.addEventListener('mousedown', e => {
                if (!e.target.classList.contains('resizer')) return;

                current = e.target.parentElement;
                next = current.nextElementSibling;

                // find the next non-collapsed section
                while (next && next.classList.contains('collapsed')) {
                    next = next.nextElementSibling;
                }

                if (!next) { current = null; return; } // no valid next section

                startY = e.clientY;
                startFlex = parseFloat(current.style.flex || 1);
                nextFlex = parseFloat(next.style.flex || 1);

                document.body.style.cursor = 'row-resize';
                e.preventDefault();
            });

            document.addEventListener('mousemove', e => {
                if (!current || !next) return;
                const dy = e.clientY - startY;
                const containerHeight = container.offsetHeight;
                const deltaRatio = dy / containerHeight * (startFlex + nextFlex);

                const newFlex = Math.max(0.2, startFlex + deltaRatio);
                const newNextFlex = Math.max(0.2, nextFlex - deltaRatio);

                current.style.flex = newFlex;
                next.style.flex = newNextFlex;
            });

            document.addEventListener('mouseup', () => {
                if (current) saveStates();
                current = null;
                next = null;
                document.body.style.cursor = '';
            });

            loadStates();
        })();
    </script>
</body>

</html>